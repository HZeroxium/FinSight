# =============================================================================
# FIN SIGHT PREDICTION SERVICE - ENVIRONMENT CONFIGURATION
# =============================================================================
# Copy this file to .env and customize for your environment
# All variables support environment variable override

# =============================================================================
# SERVICE CONFIGURATION
# =============================================================================
# Application information
APP_NAME=FinSight Prediction Service
APP_VERSION=1.0.0
DEBUG=false

# API binding
API_HOST=0.0.0.0
API_PORT=8000

# =============================================================================
# EUREKA CLIENT CONFIGURATION
# =============================================================================
# Enable/disable Eureka client registration
ENABLE_EUREKA_CLIENT=true

# Eureka server connection
EUREKA_SERVER_URL=http://localhost:8761
EUREKA_APP_NAME=prediction-service

# Instance identification
EUREKA_INSTANCE_ID=
EUREKA_HOST_NAME=
EUREKA_IP_ADDRESS=
EUREKA_PORT=8000
EUREKA_SECURE_PORT=8443
EUREKA_SECURE_PORT_ENABLED=false

# Instance URLs
EUREKA_HOME_PAGE_URL=
EUREKA_STATUS_PAGE_URL=
EUREKA_HEALTH_CHECK_URL=

# VIP addresses
EUREKA_VIP_ADDRESS=
EUREKA_SECURE_VIP_ADDRESS=
EUREKA_PREFER_IP_ADDRESS=true

# =============================================================================
# EUREKA TIMING CONFIGURATION
# =============================================================================
# Lease management
EUREKA_LEASE_RENEWAL_INTERVAL_IN_SECONDS=30
EUREKA_LEASE_EXPIRATION_DURATION_IN_SECONDS=90

# Registry operations
EUREKA_REGISTRY_FETCH_INTERVAL_SECONDS=30
EUREKA_INSTANCE_INFO_REPLICATION_INTERVAL_SECONDS=30
EUREKA_INITIAL_INSTANCE_INFO_REPLICATION_INTERVAL_SECONDS=40

# Heartbeat settings
EUREKA_HEARTBEAT_INTERVAL_SECONDS=30

# =============================================================================
# EUREKA RETRY CONFIGURATION
# =============================================================================
# Registration retry settings
EUREKA_REGISTRATION_RETRY_ATTEMPTS=3
EUREKA_REGISTRATION_RETRY_DELAY_SECONDS=5

# Heartbeat retry settings
EUREKA_HEARTBEAT_RETRY_ATTEMPTS=3
EUREKA_HEARTBEAT_RETRY_DELAY_SECONDS=2

# Retry backoff configuration
EUREKA_RETRY_BACKOFF_MULTIPLIER=2.0
EUREKA_MAX_RETRY_DELAY_SECONDS=60

# Auto-reregistration
EUREKA_ENABLE_AUTO_RE_REGISTRATION=true
EUREKA_RE_REGISTRATION_DELAY_SECONDS=10

# =============================================================================
# DIRECTORY CONFIGURATION
# =============================================================================
# Base directory paths (relative to prediction_service root)
BASE_DIR=
DATA_DIR=
MODELS_DIR=
LOGS_DIR=
JOBS_DIR=

# =============================================================================
# MODEL MANAGEMENT CONFIGURATION
# =============================================================================
# Model naming and file patterns
MODEL_NAME_PATTERN={symbol}_{timeframe}_{model_type}
CHECKPOINT_FILENAME=model.pt
METADATA_FILENAME=metadata.json
CONFIG_FILENAME=config.json

# =============================================================================
# MODEL TRAINING DEFAULTS
# =============================================================================
# Default training parameters
DEFAULT_CONTEXT_LENGTH=64
DEFAULT_PREDICTION_LENGTH=1
DEFAULT_NUM_EPOCHS=10
DEFAULT_BATCH_SIZE=32
DEFAULT_LEARNING_RATE=0.001

# =============================================================================
# FALLBACK STRATEGY CONFIGURATION
# =============================================================================
# Enable/disable model fallback strategies
ENABLE_MODEL_FALLBACK=true

# Fallback strategy selection
FALLBACK_STRATEGY=timeframe_and_symbol

# Fallback priority lists (comma-separated)
FALLBACK_TIMEFRAME_PRIORITY=1d,4h,1h,15m,5m,1m,12h,1w
FALLBACK_SYMBOL_PRIORITY=BTCUSDT,ETHUSDT,BNBUSDT
FALLBACK_MODEL_TYPE_PRIORITY=ibm/patchtst-forecasting,ibm/patchtsmixer-forecasting,pytorch-lightning/time-series-transformer,enhanced-transformer

# Fallback limits
MAX_FALLBACK_ATTEMPTS=5
FALLBACK_TIMEOUT=30.0

# =============================================================================
# DEVICE CONFIGURATION
# =============================================================================
# Force CPU usage (overrides GPU detection)
FORCE_CPU=false

# CUDA device configuration
CUDA_VISIBLE_DEVICES=
CUDA_DEVICE_MEMORY_FRACTION=0.8

# Mixed precision training
ENABLE_MIXED_PRECISION=true

# =============================================================================
# MODEL LIMITS
# =============================================================================
# Maximum allowed values
MAX_CONTEXT_LENGTH=512
MAX_PREDICTION_LENGTH=24
MAX_NUM_EPOCHS=100

# =============================================================================
# CACHE SETTINGS
# =============================================================================
# Model caching configuration
ENABLE_MODEL_CACHE=true
MAX_CACHED_MODELS=5

# =============================================================================
# SERVING ADAPTER CONFIGURATION
# =============================================================================
# Serving backend selection (simple, triton, torchserve)
SERVING_ADAPTER_TYPE=simple

# =============================================================================
# SIMPLE ADAPTER SETTINGS
# =============================================================================
# In-memory model serving
SIMPLE_MAX_MODELS_IN_MEMORY=5
SIMPLE_MODEL_TIMEOUT_SECONDS=3600

# =============================================================================
# TRITON ADAPTER SETTINGS
# =============================================================================
# Triton Inference Server connection
TRITON_SERVER_URL=localhost:8000
TRITON_SERVER_GRPC_URL=localhost:8001
TRITON_USE_GRPC=false
TRITON_SSL=false
TRITON_INSECURE=true

# Triton model repository
TRITON_MODEL_REPOSITORY=/models
TRITON_DEFAULT_MODEL_VERSION=1
TRITON_MAX_BATCH_SIZE=8
TRITON_TIMEOUT_SECONDS=30

# =============================================================================
# TORCHSERVE ADAPTER SETTINGS
# =============================================================================
# TorchServe connection URLs
TORCHSERVE_INFERENCE_URL=http://localhost:8080
TORCHSERVE_MANAGEMENT_URL=http://localhost:8081
TORCHSERVE_METRICS_URL=http://localhost:8082

# TorchServe configuration
TORCHSERVE_MODEL_STORE=./model_store
TORCHSERVE_BATCH_SIZE=1
TORCHSERVE_MAX_BATCH_DELAY=100
TORCHSERVE_TIMEOUT_SECONDS=30
TORCHSERVE_INITIAL_WORKERS=1
TORCHSERVE_MAX_WORKERS=4

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================
# Redis connection
REDIS_URL=redis://localhost:6379/0

# Training job repository type
TRAINING_JOB_REPOSITORY_TYPE=file

# =============================================================================
# CLOUD STORAGE CONFIGURATION
# =============================================================================
# Storage provider selection (minio, digitalocean, aws, s3)
STORAGE_PROVIDER=minio

# S3-compatible storage (MinIO, AWS S3)
S3_ENDPOINT_URL=http://localhost:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin
S3_REGION_NAME=us-east-1
S3_BUCKET_NAME=market-data
S3_USE_SSL=false
S3_VERIFY_SSL=true
S3_SIGNATURE_VERSION=s3v4
S3_MAX_POOL_CONNECTIONS=50

# DigitalOcean Spaces specific settings
SPACES_ENDPOINT_URL=https://nyc3.digitaloceanspaces.com
SPACES_ACCESS_KEY=
SPACES_SECRET_KEY=
SPACES_REGION_NAME=nyc3
SPACES_BUCKET_NAME=finsight-market-data

# AWS S3 specific settings
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION_NAME=us-east-1
AWS_BUCKET_NAME=finsight-market-data

# =============================================================================
# MLFLOW CONFIGURATION
# =============================================================================
# MLflow tracking server
MLFLOW_TRACKING_URI=http://localhost:5000
MLFLOW_REGISTRY_URI=http://localhost:5000

# MLflow experiment settings
MLFLOW_EXPERIMENT_NAME=FinSight Prediction Models
MLFLOW_DEFAULT_ARTIFACT_ROOT=./mlruns

# =============================================================================
# DATA LOADER CONFIGURATION
# =============================================================================
# Data loader type selection
DATA_LOADER_TYPE=local

# Local data loader settings
LOCAL_DATA_LOADER_BASE_PATH=./data
LOCAL_DATA_LOADER_CACHE_ENABLED=true
LOCAL_DATA_LOADER_CACHE_TTL=3600

# Cloud data loader settings
CLOUD_DATA_LOADER_BASE_PATH=
CLOUD_DATA_LOADER_CACHE_ENABLED=true
CLOUD_DATA_LOADER_CACHE_TTL=3600

# =============================================================================
# EXPERIMENT TRACKER CONFIGURATION
# =============================================================================
# Experiment tracker type selection
EXPERIMENT_TRACKER_TYPE=mlflow

# MLflow experiment tracker settings
MLFLOW_EXPERIMENT_TRACKER_EXPERIMENT_NAME=FinSight Prediction Models
MLFLOW_EXPERIMENT_TRACKER_ARTIFACT_LOCATION=./mlruns
MLFLOW_EXPERIMENT_TRACKER_TRACKING_URI=http://localhost:5000

# =============================================================================
# MODEL SERVING CONFIGURATION
# =============================================================================
# Model serving type selection
MODEL_SERVING_TYPE=simple

# Simple model serving settings
SIMPLE_MODEL_SERVING_MAX_MODELS_IN_MEMORY=5
SIMPLE_MODEL_SERVING_MODEL_TIMEOUT_SECONDS=3600

# Triton model serving settings
TRITON_MODEL_SERVING_SERVER_URL=localhost:8000
TRITON_MODEL_SERVING_GRPC_URL=localhost:8001
TRITON_MODEL_SERVING_USE_GRPC=false
TRITON_MODEL_SERVING_SSL=false
TRITON_MODEL_SERVING_INSECURE=true
TRITON_MODEL_SERVING_MODEL_REPOSITORY=/models
TRITON_MODEL_SERVING_DEFAULT_MODEL_VERSION=1
TRITON_MODEL_SERVING_MAX_BATCH_SIZE=8
TRITON_MODEL_SERVING_TIMEOUT_SECONDS=30

# TorchServe model serving settings
TORCHSERVE_MODEL_SERVING_INFERENCE_URL=http://localhost:8080
TORCHSERVE_MODEL_SERVING_MANAGEMENT_URL=http://localhost:8081
TORCHSERVE_MODEL_SERVING_METRICS_URL=http://localhost:8082
TORCHSERVE_MODEL_SERVING_MODEL_STORE=./model_store
TORCHSERVE_MODEL_SERVING_BATCH_SIZE=1
TORCHSERVE_MODEL_SERVING_MAX_BATCH_DELAY=100
TORCHSERVE_MODEL_SERVING_TIMEOUT_SECONDS=30
TORCHSERVE_MODEL_SERVING_INITIAL_WORKERS=1
TORCHSERVE_MODEL_SERVING_MAX_WORKERS=4

# ===== Cleanup Configuration =====
# Background cleanup interval (1m, 5m, 15m, 1h, 4h, 12h, 1d, 1w, disabled)
# For development, you might want to use 1m or 5m for faster cleanup cycles
CLEANUP_INTERVAL=1d

# Enable/disable cleanup targets
ENABLE_CLOUD_CACHE_CLEANUP=true
ENABLE_DATASETS_CLEANUP=true
ENABLE_MODELS_CLEANUP=true

# Cleanup age thresholds (in hours)
CLOUD_CACHE_MAX_AGE_HOURS=24      # 1 day
DATASETS_MAX_AGE_HOURS=168        # 7 days
MODELS_MAX_AGE_HOURS=720          # 30 days